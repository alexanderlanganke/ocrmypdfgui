name: ocrmypdfgui # you probably want to 'snapcraft register <name>'
title: ocrmypdfgui
base: core18 # the base snap is the execution environment for this snap
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: Hobby Project GUI for the Python Program "OCRmyPDF" by James R. Barlow
description: |
  I use James R. Barlow's OCRmyPDF heavily in my paperless Office and have created this Python Project as a GUI wrapper to run batch jobs on my filesystem. This is strictly a Hobby Project and is not "official". Feel free to use it if you like.
icon: gui/ocrmypdfgui.svg
grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots

architectures: [amd64]

environment:
    TESSDATA_PREFIX: $SNAP/usr/share/tesseract-ocr/4.00/tessdata
    GS_LIB: $SNAP/usr/share/ghostscript/9.26/Resource/Init
    GS_FONTPATH: $SNAP/usr/share/ghostscript/9.26/Resource/Font

apps:
  ocrmypdfgui:
    command: bin/snapcraft-preload python3 $SNAP/lib/python3.6/site-packages/ocrmypdfgui/__main__.py
    command-chain: [bin/debian-multiarch-triplet-provider-launch, bin/tcltk-launch]
    #desktop: /build/ocrmypdfgui/parts/ocrmypdfgui/src/src/ocrmypdfgui/ocrmypdfgui.desktop

    extensions: [gnome-3-34]

    plugs:
      - desktop
      - desktop-legacy
      - unity7
      - wayland
      - x11
      - home
      - removable-media


parts:
#  get-source:
#    plugin: dump
#    source: https://github.com/alexanderlanganke/ocrmypdfgui.git
  # https://forum.snapcraft.io/t/the-debian-multiarch-triplet-provider-launch-stage-snap/11738
  snapcraft-preload:
    source: https://github.com/sergiusens/snapcraft-preload.git
    plugin: cmake
    build-packages:
      - on amd64:
        - gcc-multilib
        - g++-multilib

  tcltk-launch:
    plugin: nil
    stage-snaps: [tcltk-launch]
  debian-multiarch-triplet-provider-launch:
    plugin: nil
    stage-snaps: [debian-multiarch-triplet-provider-launch]

  ocrmypdfgui:
    # See 'snapcraft plugins'
    plugin: python
    source: .
    stage-packages: [python3-tk, tcl, ghostscript, icc-profiles-free, liblept5, libxml2, pngquant, tesseract-ocr-all, unpaper, qpdf, zlib1g]


    python-packages:
      - ocrmypdf
      - cffi  # must be a setup and install requirement
      - coloredlogs # strictly optional
      - img2pdf  # pure Python, so track HEAD closely
      - pdfminer.six
      - pikepdf
      - Pillow
      - pluggy
      - reportlab
      - setuptools
      - tqdm
      - tk
